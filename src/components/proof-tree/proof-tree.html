<div class="main" *ngIf="root as r">
  <div class="proof-node">
    
    <!-- Children (if any) -->
    <div class="children" *ngIf="r.children?.length">
      <app-proof-tree
        *ngFor="let child of r.children"
        [root]="child"
        [mode]="mode"
        [interactiveSubmode]="interactiveSubmode"
        [selectedNode]="selectedNode"
        [predictionRuleRequest]="predictionRuleRequest"
        (nodeClicked)="nodeClicked.emit($event)"
        (plusButtonClicked)="plusButtonClicked.emit($event)"
        (ruleSelected)="ruleSelected.emit($event)">
      </app-proof-tree>
    </div>

    <!-- Prediction inputs above the line (for predict mode) -->
    <div class="prediction-inputs" *ngIf="mode === 'interactive' && interactiveSubmode === 'predict' && hasPendingPrediction">
      <div class="prediction-inputs-wrapper-row">
        <div 
          *ngFor="let prediction of userPredictions; let i = index; trackBy: trackByIndex" 
          class="prediction-input-wrapper"
        >
          <input 
            type="text" 
            class="prediction-input-field" 
            [value]="userPredictions[i]"
            (input)="onPredictionInput($event, i)"
            [placeholder]="'Predict sequent ' + (i + 1) + ' (e.g., A âŠ¢ B)'"
            (keyup.enter)="confirmPrediction()"
            (keydown)="onKeyDown($event)"
          />
        </div>
      </div>
    </div>

    <!-- Sequent with line above and rule next to line -->
    <div
      class="conclusion"
      [ngClass]="{
        selected: isSelected
      }"
    >
      <!-- Plus button for interactive mode - only show if no rule has been applied yet -->
      <button 
        *ngIf="mode === 'interactive' && !r.children?.length && r.rule !== 'Ax'"
        class="rule-plus-btn"
        (click)="onPlusButtonClick($event)"
        title="Add rule"
      >
        <span class="plus-icon">+</span>
      </button>
      <span class="rule" *ngIf="r.children?.length || r.rule === 'Ax'">
        {{ r.rule }}
      </span>
      <div class="sequent-content">
        {{ formatSequent(r.sequent) }}
      </div>
    </div>

  </div>
</div>
